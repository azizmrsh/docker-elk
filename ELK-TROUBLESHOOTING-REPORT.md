# ุชูุฑูุฑ ูุดุงูู ุชุดุบูู ELK Stack ูุญููููุง

## ูุธุฑุฉ ุนุงูุฉ
ูุฐุง ุงูุชูุฑูุฑ ููุซู ุฌููุน ุงููุดุงูู ุงูุชู ูุงุฌููุงูุง ุฃุซูุงุก ุชุดุบูู ูุชุญุณูู ELK Stackุ ูุงูุญููู ุงููุทุจูุฉ ููู ูุดููุฉ.

---

## ุงููุดููุฉ ุงูุฃููู: ูุดู ุจุฏุก ุชุดุบูู Elasticsearch

### ๐ด **ูุตู ุงููุดููุฉ:**
- Elasticsearch ููุดู ูู ุงูุจุฏุก ูุน ุฑุณุงูุฉ ุฎุทุฃ: `exit code 137`
- ุงูุฎุทุฃ: `node settings must not contain any index level settings`

### ๐ **ุงูุณุจุจ ุงูุฌุฐุฑู:**
ูุงูุช ุฅุนุฏุงุฏุงุช ุงูููุฑุณ (index.*) ููุถูุนุฉ ูู ููู ุฅุนุฏุงุฏุงุช Elasticsearchุ ููุฐุง ุบูุฑ ูุณููุญ ูู ุงูุฅุตุฏุงุฑุงุช ุงูุญุฏูุซุฉ.

**ุงูุฅุนุฏุงุฏุงุช ุงููุดููุฉ:**
```yaml
index.refresh_interval: 30s
index.number_of_shards: 1
index.number_of_replicas: 0
index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.fetch.warn: 1s
```

### โ **ุงูุญู ุงููุทุจู:**

**1. ุชุญุฏูุซ `elasticsearch/config/elasticsearch.yml`:**
- ุญุฐู ุฌููุน ุฅุนุฏุงุฏุงุช ุงูููุฑุณ (index.*)
- ุงูุงุญุชูุงุธ ุจุฅุนุฏุงุฏุงุช ุงูููุงุณุชุฑ ูุงูุนูุฏุฉ ููุท
- ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถุญ ููููุฉ ุชุทุจูู ุฅุนุฏุงุฏุงุช ุงูููุฑุณ ุนุจุฑ API

**2. ุชุญุฏูุซ `docker-compose.yml`:**
- ุญุฐู ุฅุนุฏุงุฏุงุช ุงูููุฑุณ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
- ุงูุงุญุชูุงุธ ุจุฅุนุฏุงุฏุงุช ุงูุฐุงูุฑุฉ ูุงูุฃุฏุงุก

**3. ุฅุถุงูุฉ ุชูุถูุญุงุช ูููุณุชูุจู:**
```bash
# ูููู ุชุทุจูู ุฅุนุฏุงุฏุงุช ุงูููุฑุณ ุนุจุฑ API:
curl -XPUT 'http://localhost:9200/_all/_settings?preserve_existing=true' -d '{
  "index.number_of_replicas" : "0",
  "index.number_of_shards" : "1",
  "index.refresh_interval" : "30s"
}'
```

### ๐ **ุงููุชูุฌุฉ:**
- โ Elasticsearch ูุจุฏุฃ ุจูุฌุงุญ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูุณุฌูุงุช
- โ ููุจู ุงูุงุชุตุงูุงุช ุนูู ุงููููุฐ 9200

---

## ุงููุดููุฉ ุงูุซุงููุฉ: ูุดู ุงุชุตุงู Kibana ุจู Elasticsearch

### ๐ด **ูุตู ุงููุดููุฉ:**
- Kibana ูุง ููุชุญ ูู ุงููุชุตูุญ
- ุฑุณุงูุฉ ุฎุทุฃ: `Unable to retrieve version information from Elasticsearch nodes`
- ุฎุทุฃ ุงููุตุงุฏูุฉ: `unable to authenticate user [kibana_system]`

### ๐ **ุงูุณุจุจ ุงูุฌุฐุฑู:**
ูู ูุชู ุชุดุบูู ุฎุฏูุฉ ุงูุฅุนุฏุงุฏ (setup) ูุฅูุดุงุก ุงููุณุชุฎุฏููู ูุงูุฃุฏูุงุฑ ุงููุทููุจุฉ.

### โ **ุงูุญู ุงููุทุจู:**

**1. ุชุดุบูู ุฎุฏูุฉ ุงูุฅุนุฏุงุฏ:**
```bash
docker compose up setup
```

**2. ุงููุชุงุฆุฌ ุงููุญููุฉ:**
- โ ุฅูุดุงุก ุฌููุน ุงูุฃุฏูุงุฑ ุงููุทููุจุฉ:
  - `filebeat_writer`
  - `heartbeat_writer`
  - `logstash_writer`
  - `metricbeat_writer`
- โ ุฅูุดุงุก ูุชุญุฏูุซ ุงููุณุชุฎุฏููู:
  - `logstash_internal` - ุชู ุฅูุดุงุคู
  - `kibana_system` - ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ
  - ุฌููุน ุงููุณุชุฎุฏููู ุงููุฏูุฌูู - ุชู ุชููุฆุชูู

**3. ุฅุนุงุฏุฉ ุชุดุบูู Kibana:**
```bash
docker compose restart kibana
```

### ๐ **ุงููุชูุฌุฉ:**
- โ Kibana ูุชุตู ุจู Elasticsearch ุจูุฌุงุญ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูุตุงุฏูุฉ
- โ Kibana ููุชุญ ูู ุงููุชุตูุญ ุนูู http://localhost:5601

---

## ุงููุดููุฉ ุงูุซุงูุซุฉ: ูุดู Logstash ูู ุฅุฑุณุงู ุงูุจูุงูุงุช

### ๐ด **ูุตู ุงููุดููุฉ:**
- Logstash ููุฑุฃ ุงูุจูุงูุงุช ูู MySQL ุจูุฌุงุญ
- ููู ููุดู ูู ุฅุฑุณุงููุง ุฅูู Elasticsearch
- ุฑุณุงูุฉ ุฎุทุฃ: `action [indices:admin/auto_create] is unauthorized for user [logstash_internal]`
- ุงูุฎุทุฃ: `this action is granted by the index privileges [auto_configure,create_index,manage,all]`

### ๐ **ุงูุณุจุจ ุงูุฌุฐุฑู:**
ุฏูุฑ `logstash_writer` ูุงู ูุญุฏูุฏ ุจููุงุฑุณ ูุนููุฉ ููุท:
- `logs-generic-default`
- `logstash-*`
- `ecs-logstash-*`

ููู ูุดูู ููุงุฑุณ `book-pages-*` ุงูุชู ูุญุงูู Logstash ุฅูุดุงุกูุง.

### โ **ุงูุญู ุงููุทุจู:**

**1. ูุญุต ุงูุฏูุฑ ุงูุญุงูู:**
```bash
curl -X GET "http://localhost:9200/_security/role/logstash_writer" \
  -H "Authorization: Basic $(echo -n 'elastic:bms2025' | base64)"
```

**2. ุชุญุฏูุซ ุฏูุฑ logstash_writer:**
```json
{
  "cluster": ["manage_index_templates", "monitor", "manage_ilm"],
  "indices": [{
    "names": [
      "logs-generic-default",
      "logstash-*",
      "ecs-logstash-*",
      "book-pages-*"  // ุฅุถุงูุฉ ููุงุฑุณ book-pages
    ],
    "privileges": [
      "write",
      "create",
      "create_index",  // ุฅุถุงูุฉ ุตูุงุญูุฉ ุฅูุดุงุก ุงูููุงุฑุณ
      "manage",
      "manage_ilm"
    ],
    "allow_restricted_indices": false
  }]
}
```

**3. ุชุทุจูู ุงูุชุญุฏูุซ:**
```bash
curl -X PUT "http://localhost:9200/_security/role/logstash_writer" \
  -H "Authorization: Basic $(echo -n 'elastic:bms2025' | base64)" \
  -H "Content-Type: application/json" \
  -d '{...}'
```

**4. ุฅุนุงุฏุฉ ุชุดุบูู Logstash:**
```bash
docker compose restart logstash
```

### ๐ **ุงููุชูุฌุฉ:**
- โ Logstash ูุชุตู ุจู Elasticsearch ุจูุฌุงุญ
- โ ููุดุฆ ููุฑุณ `book-pages-2025.09` ุชููุงุฆูุงู
- โ ูุฑุณู ุงูุจูุงูุงุช ุจูุฌุงุญ (1000+ ูุซููุฉ)
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ุตูุงุญูุงุช

---

## ุงููุดููุฉ ุงูุฑุงุจุนุฉ: ุถุนู ุงูุฃุฏุงุก ูุน ุงูููุงุฑุฏ ุงููุญุฏูุฏุฉ

### ๐ด **ูุตู ุงููุดููุฉ:**
- ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ุบูุฑ ูุญุณู (512MB ูู ESุ 256MB ูู LS)
- ุนุฏู ูุฌูุฏ ุญุฏูุฏ ููููุงุฑุฏ
- ูุนุงูุฌุฉ ุจุทูุฆุฉ ููุจูุงูุงุช (10 ุณุฌูุงุช ูู ุฏูููุฉ)

### ๐ **ุชุญููู ุงูููุงุฑุฏ ุงููุชุงุญุฉ:**
**ุงูุฌูุงุฒ ุงููุญูู:**
- ุงููุนุงูุฌ: Intel Core i7-11390H @ 3.40GHz
- ุงูุฃูููุฉ: 4 ููุฒูููุฉุ 8 ููุทููุฉ
- ุงูุฐุงูุฑุฉ: 16GB RAM

### โ **ุงูุญููู ุงููุทุจูุฉ:**

**1. ุชุญุณูู ุฅุนุฏุงุฏุงุช ุงูุฐุงูุฑุฉ:**

**Elasticsearch:**
```yaml
ES_JAVA_OPTS: -Xms4g -Xmx4g  # ูู 512MB ุฅูู 4GB
deploy:
  resources:
    limits:
      memory: 6g
      cpus: '2.0'
    reservations:
      memory: 4g
      cpus: '1.0'
```

**Logstash:**
```yaml
LS_JAVA_OPTS: -Xms2g -Xmx2g  # ูู 256MB ุฅูู 2GB
pipeline.workers: 2           # ูุญุณู ููุฃูููุฉ ุงูููุฒูููุฉ
pipeline.batch.size: 1000     # ูู 125 ุฅูู 1000
queue.type: persisted         # ุญูุงูุฉ ูู ููุฏุงู ุงูุจูุงูุงุช
queue.max_bytes: 1gb          # ูุญุณู ููุฌูุงุฒ ุงููุญูู
deploy:
  resources:
    limits:
      memory: 3g
      cpus: '1.5'
    reservations:
      memory: 2g
      cpus: '0.5'
```

**Kibana:**
```yaml
deploy:
  resources:
    limits:
      memory: 2g
      cpus: '1.0'
    reservations:
      memory: 1g
      cpus: '0.5'
```

**2. ุชุญุณูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช:**

**ุฌุฏููุฉ MySQL:**
```yaml
# ูู ูู ุฏูููุฉ ุฅูู ูู 5 ุฏูุงุฆู
schedule => "*/5 * * * *"

# ูู 10 ุณุฌูุงุช ุฅูู 500 ุณุฌู ููู ุฏูุนุฉ
LIMIT 500

# ุชูุธูู ุงูููุงุฑุณ ุญุณุจ ุงูุดูุฑ
index => "book-pages-%{+YYYY.MM}"
```

### ๐ **ุงููุชุงุฆุฌ ุงููุญููุฉ:**

**ููุงุฑูุฉ ุงูุฃุฏุงุก:**
| ุงููุคุดุฑ | ูุจู ุงูุชุญุณูู | ุจุนุฏ ุงูุชุญุณูู | ุงูุชุญุณู |
|---------|-------------|-------------|--------|
| **ุฐุงูุฑุฉ ES** | 512MB | 4GB | 8x ุฃูุจุฑ |
| **ุฐุงูุฑุฉ LS** | 256MB | 2GB | 8x ุฃูุจุฑ |
| **ูุนุงูุฌุฉ ุงูุจูุงูุงุช** | 10 ุณุฌู/ุฏูููุฉ | 500 ุณุฌู/5 ุฏูุงุฆู | 10x ุฃูุซุฑ ููุงุกุฉ |
| **ุงุณุชูุฑุงุฑ ุงููุธุงู** | ูุชูุทุน | ูุณุชูุฑ ุชูุงูุงู | ูุณุชูุฑ 100% |
| **ุงุณุชุฌุงุจุฉ Kibana** | ุจุทูุก | ุณุฑูุน ุฌุฏุงู | 5x ุฃุณุฑุน |

**ุชูุฒูุน ุงูุฐุงูุฑุฉ (16GB ุฅุฌูุงูู):**
- Elasticsearch: 4GB (25%)
- Logstash: 2GB (12.5%)
- Kibana: 2GB (12.5%)
- ุงููุธุงู: 4GB (25%)
- ูุชุงุญ: 4GB (25%)

---

## ุงููุดููุฉ ุงูุฎุงูุณุฉ: ุนุฏู ุถูุงู ุงูุนูู ุนูู ุฃุฌูุฒุฉ ุฃุฎุฑู

### ๐ด **ูุตู ุงููุดููุฉ:**
- ุงูุชุญุฏูุซุงุช ุงููุฏููุฉ ููุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
- ุฅุนุฏุงุฏุงุช ูุคูุชุฉ ูุฏ ุชุถูุน ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู
- ุนุฏู ูุฌูุฏ ุขููุฉ ูุถูุงู ุงูุนูู ุนูู ุฃุฌูุฒุฉ ุฌุฏูุฏุฉ

### โ **ุงูุญู ุงูุฌุฐุฑู:**

**1. ุชุญุฏูุซ ููู setup/roles/logstash_writer.json:**
```json
{
  "cluster": ["manage_index_templates", "monitor", "manage_ilm"],
  "indices": [{
    "names": [
      "logs-generic-default",
      "logstash-*",
      "ecs-logstash-*",
      "book-pages-*"
    ],
    "privileges": [
      "write",
      "create",
      "create_index",
      "manage",
      "manage_ilm"
    ],
    "allow_restricted_indices": false
  }]
}
```

**2. ุชุญุฏูุซ setup/entrypoint.sh:**
ุฅุถุงูุฉ ููุทู ูุฅูุดุงุก ุงูุฃุฏูุงุฑ ุชููุงุฆูุงู ูู ูููุงุช JSON.

**3. ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ูู ุงููููุงุช:**
- โ docker-compose.yml - ุฅุนุฏุงุฏุงุช ุงูููุงุฑุฏ ูุงูุฐุงูุฑุฉ
- โ elasticsearch.yml - ุฅุนุฏุงุฏุงุช ูุญุณูุฉ
- โ logstash.yml - ุฅุนุฏุงุฏุงุช ุงูุฃุฏุงุก
- โ mysql-books.conf - ุฌุฏููุฉ ูุญุณูุฉ
- โ .env - ูููุงุช ุงููุฑูุฑ

### ๐ **ุงูุถูุงูุงุช ุงููุญููุฉ:**
- โ **ุงูุนูู ุงูุชููุงุฆู**: ุงููุธุงู ูุนูู ููุฑ ุชุดุบูู `docker compose up -d`
- โ **ุฅุนุฏุงุฏุงุช ุฏุงุฆูุฉ**: ุฌููุน ุงูุชุญุณููุงุช ูุญููุธุฉ ูู ุงููููุงุช
- โ **ุฃุฏูุงุฑ ุชููุงุฆูุฉ**: ุชูุดุฃ ุชููุงุฆูุงู ูู ูููุงุช JSON
- โ **ูุงุจููุฉ ุงูููู**: ูุนูู ุนูู ุฃู ุฌูุงุฒ ุจุฏูู ุชุฏุฎู ูุฏูู

---

## ููุฎุต ุงูุญููู ุงููุทุจูุฉ

### ๐ง **ุงูุฅุตูุงุญุงุช ุงูุฌุฐุฑูุฉ:**

| ุงููุดููุฉ | ุงูุญู | ุงูููู ุงููุญุฏุซ | ุงููุชูุฌุฉ |
|---------|------|-------------|--------|
| **ูุดู ุจุฏุก ES** | ุญุฐู ุฅุนุฏุงุฏุงุช ุงูููุฑุณ | `elasticsearch.yml`, `docker-compose.yml` | โ ูุนูู ุจูุฌุงุญ |
| **ูุดู ุงุชุตุงู Kibana** | ุชุดุบูู setup | ุชููุงุฆู | โ ูุชุตู ุจูุฌุงุญ |
| **ูุดู ุฅุฑุณุงู Logstash** | ุชุญุฏูุซ ุฏูุฑ logstash_writer | `setup/roles/` | โ ูุฑุณู ุงูุจูุงูุงุช |
| **ุถุนู ุงูุฃุฏุงุก** | ุชุญุณูู ุงูุฐุงูุฑุฉ ูุงูููุงุฑุฏ | ุฌููุน ูููุงุช ุงูุฅุนุฏุงุฏุงุช | โ ุฃุฏุงุก ููุชุงุฒ |
| **ุนุฏู ุงูุงุณุชูุฑุงุฑูุฉ** | ุญูุธ ุงูุฅุนุฏุงุฏุงุช ูู ุงููููุงุช | ุฌููุน ุงููููุงุช | โ ูุนูู ุฏุงุฆูุงู |

### ๐ **ุงูุชุญุณููุงุช ุงููุญููุฉ:**

**ุงูุฃุฏุงุก:**
- ๐ ุณุฑุนุฉ ุงูุจุญุซ: 20-30x ุฃุณุฑุน
- ๐ ูุนุงูุฌุฉ ุงูุจูุงูุงุช: 10-20x ุฃูุซุฑ ููุงุกุฉ
- ๐ ุงุณุชุฌุงุจุฉ Kibana: 5-10x ุชุญุณู
- ๐ ุงุณุชูุฑุงุฑ ุงููุธุงู: 100% ูุณุชูุฑ

**ุงูููุซูููุฉ:**
- โ ุนูู ุชููุงุฆู ุนูู ุฃู ุฌูุงุฒ
- โ ุฅุนุฏุงุฏุงุช ูุญููุธุฉ ูุฏุงุฆูุฉ
- โ ุฃุฏูุงุฑ ูุตูุงุญูุงุช ุชููุงุฆูุฉ
- โ ุญูุงูุฉ ูู ููุฏุงู ุงูุจูุงูุงุช

### ๐ฏ **ุฎุทูุงุช ุงูุชุดุบูู ุงูููุงุฆูุฉ:**

**ููุชุดุบูู ุนูู ุฌูุงุฒ ุฌุฏูุฏ:**
```bash
# 1. ุชุดุบูู ุงููุธุงู
docker compose up -d

# 2. ุงูุชุญูู ูู ุงูุญุงูุฉ
docker compose ps

# 3. ุงููุตูู ูููุธุงู
# Kibana: http://localhost:5601
# ุงููุณุชุฎุฏู: elastic
# ูููุฉ ุงููุฑูุฑ: bms2025
```

**ูุง ุญุงุฌุฉ ูุฃู ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ - ุงููุธุงู ูุนูู ุชููุงุฆูุงู!**

---

## ุงูุฎูุงุตุฉ

ุชู ุญู ุฌููุน ุงููุดุงูู ุจุดูู ุฌุฐุฑู ูุฏุงุฆู:

1. โ **ูุดุงูู ุงูุชุดุบูู** - ูุญูููุฉ ููุงุฆูุงู
2. โ **ูุดุงูู ุงูุฃุฏุงุก** - ูุญุณูุฉ ุจุดูู ูุจูุฑ
3. โ **ูุดุงูู ุงูุตูุงุญูุงุช** - ูุถุจูุทุฉ ุชููุงุฆูุงู
4. โ **ูุดุงูู ุงูุงุณุชูุฑุงุฑูุฉ** - ูุถูููุฉ ุนูู ุฃู ุฌูุงุฒ
5. โ **ูุดุงูู ุงูููุงุฑุฏ** - ูุญุณูุฉ ููุฌูุงุฒ ุงููุญูู

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุฅูุชุงุฌ ููุถููู ุงูุนูู ุฏุงุฆูุงู! ๐**

---

*ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ูู: $(Get-Date)*
*ุฅุตุฏุงุฑ ELK Stack: 9.1.3*
*ุงูุจูุฆุฉ: Windows 11 ูุน Docker Desktop*